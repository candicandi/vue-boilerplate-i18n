import{i as m,Y as b,f as T,r as n,o as p,v as $,n as r,m as l,x as f,G as y,M as N,O as E,a1 as k,L as j,w,X as B,l as v,a2 as F,D as P,P as M,S as H}from"./vendor.1a748529.js";import{_ as g,u as V}from"./index.1e8b5d6f.js";import{N as I}from"./NavBar.9d36e2e4.js";import R from"./ProjectForm.c5ad10fb.js";import O from"./TableHeader.6ab40e6b.js";import{c as D,P as U,u as A}from"./TableBody.352aab1f.js";import{l as G}from"./lodash.daa4b3dd.js";import"./Translations.c57e7b3c.js";import"./ProjectItem.9e43a693.js";const K=m({name:"NavigationSideLogo",setup(){const e=b();return{title:T(()=>e.t("base.systemTitle"))}}}),X={class:"side-logo-container"},Y=(e=>(N("data-v-0574b5c5"),e=e(),E(),e))(()=>f("img",{class:"side-logo-img",src:"assets/i18n.8595eb6e.svg",alt:"\u5546\u6807"},null,-1)),q={class:"side-logo-title"};var z=g(K,[["render",function(e,a,s,o,t,d){const c=n("router-link");return p(),$("div",X,[r(c,{to:`/${e.$route.params.locale||""}`},{default:l(()=>[Y,f("h1",q,y(e.title),1)]),_:1},8,["to"])])}],["__scopeId","data-v-0574b5c5"]]);const J=m({name:"SearchSelect",components:{Loading:k},props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fetch:{type:Function,default:()=>()=>{}}},emits:["update:modelValue","change","select"],setup(e){const{proxy:a}=V(),s=j(!1),o=j("");return w(()=>e.modelValue,t=>{o.value=t},{immediate:!0}),w(()=>o,G.exports.debounce(function(t){a.$emit("update:modelValue",t),a.$emit("change",t)},300)),{loading:s,searchValue:o}},methods:{keydown(e){e.keyCode===229&&(e.returnValue=!1,e.stopPropagation()),e.keyCode===32&&(e.returnValue=!1)},getExecText:e=>e.replace(new RegExp(/(<([^>]+)>)/,"gi"),""),handleSelect({value:e}){this.$emit("select",e)},async handleSearch(e,a){const s=e.toLowerCase().replace(new RegExp(/[-[\]{}()*+?.,\\^$|#\s]/g),"\\$&");let o=[];if(!s)return void a(o);this.loading=!0,o=await this.fetch(s)||[],o.forEach(t=>{t.label=t.label.replace(new RegExp(s,"gi"),d=>`<span class="search-select-highlight">${d}</span>`)}),a(o),setTimeout(()=>{B(()=>{this.loading=!1})},200)}}}),Q=["title","innerHTML"],W=m({name:"SearchCorporation",components:{SearchSelect:g(J,[["render",function(e,a,s,o,t,d){const c=n("loading"),u=n("el-icon"),h=n("IconFont"),S=n("el-autocomplete");return p(),v(S,P({modelValue:e.searchValue,"onUpdate:modelValue":a[0]||(a[0]=i=>e.searchValue=i),modelModifiers:{trim:!0}},e.$attrs,{class:"search-input-container","popper-class":"search-select-container","trigger-on-focus":!1,"fetch-suggestions":e.handleSearch,placeholder:e.placeholder,onSelect:e.handleSelect,onKeydownCapture:a[1]||(a[1]=i=>e.keydown(i))}),F({default:l(({item:i})=>[f("span",{title:e.getExecText(i.label),innerHTML:i.label},null,8,Q)]),_:2},[e.loading?{name:"suffix",fn:l(()=>[r(u,{class:"search-loading-icon"},{default:l(()=>[r(c)]),_:1})])}:{name:"suffix",fn:l(()=>[f("i",{class:"search-icon"},[r(h,{icon:"iconsearch"})])])}]),1040,["modelValue","fetch-suggestions","placeholder","onSelect"])}]])},emits:["select"],setup:()=>({searchValue:j("")}),methods:{handleFetchSearch:async e=>D.map(a=>({value:a,label:a})),handleSelectSearch(e){this.$emit("select",e)}}});var ie=g(m({name:"ProjectList",components:{NavigationNavBar:I,NavigationSideLogo:z,ProjectTableHeader:O,ProjectTableBody:U,SearchCorporation:g(W,[["render",function(e,a,s,o,t,d){const c=n("SearchSelect");return p(),v(c,P({modelValue:e.searchValue,"onUpdate:modelValue":a[0]||(a[0]=u=>e.searchValue=u),fetch:e.handleFetchSearch,placeholder:"\u641C\u7D22\u9879\u76EE","select-when-unmatched":"","highlight-first-item":""},e.$attrs,{onSelect:e.handleSelectSearch}),null,16,["modelValue","fetch","onSelect"])}]])},setup(){const{proxy:e}=V(),a=A(),s=b();function o(t){a.getProjectList({kw:t})}return o(),{handleCreateProject:function(){const t=H({name:"",corpName:"",notes:""});e.$ModalDialog({title:s.t("project.create"),top:"10vh",width:"50vw",showClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,renderComponent:{data:t,component:R},async onConfirm(d,c){if(!await d.validateRules())return Promise.reject(new Error("error"));c.fullLoading=!0;const{error:u,data:h}=await a.createProject(t);if(c.fullLoading=!1,u)return Promise.reject(new Error("error"));a.getProjectList()}})},handleSelectSearch:o}}}),[["render",function(e,a,s,o,t,d){const c=n("NavigationSideLogo"),u=n("NavigationNavBar"),h=n("IconFont"),S=n("el-button"),i=n("LayoutSection"),x=n("SearchCorporation"),L=n("ProjectTableHeader"),_=n("ProjectTableBody"),C=n("LayoutArea");return p(),v(C,null,{top:l(()=>[r(u,{fixed:!1},{default:l(()=>[r(c)]),_:1})]),side:l(()=>[r(i,{title:e._t("project.manageTitle")},{default:l(()=>[r(S,{type:"primary",class:"create-action",onClick:a[0]||(a[0]=Z=>e.handleCreateProject())},{default:l(()=>[r(h,{icon:"iconestablish"}),M(" "+y(e._t("project.create")),1)]),_:1})]),_:1},8,["title"])]),content:l(()=>[r(i,{"has-divider":"","flex-content":""},{head:l(()=>[r(x,{onSelect:e.handleSelectSearch},null,8,["onSelect"])]),default:l(()=>[r(L),r(_)]),_:1})]),_:1})}],["__scopeId","data-v-ca6f0964"]]);export{ie as default};
