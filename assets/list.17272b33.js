import{d as _,y as v,i as N,_ as f,o as g,b as T,h as n,w as s,r as o,e as h,t as V,v as k,x as I,l as E,f as S,A as y,B,C as w,c as $,D as F,G as j,H as x,I as H}from"./index.774825cc.js";import{N as D}from"./NavBar.305b2228.js";import M from"./ProjectForm.2db5a9e4.js";import R from"./TableHeader.727a7ea2.js";import{c as A,P as U,u as q}from"./TableBody.06946c4a.js";import{l as O}from"./lodash.67702ffd.js";import"./Translations.66339995.js";import"./ProjectItem.751bc8bd.js";const G=_({name:"NavigationSideLogo",setup(){const e=v();return{title:N(()=>e.t("base.systemTitle"))}}}),K=""+new URL("i18n.8595eb6e.svg",import.meta.url).href;const z=e=>(k("data-v-43e184f5"),e=e(),I(),e),J={class:"side-logo-container"},Q=z(()=>h("img",{class:"side-logo-img",src:K,alt:"\u5546\u6807"},null,-1)),W={class:"side-logo-title"};function X(e,t,c,a,r,l){const i=o("router-link");return g(),T("div",J,[n(i,{to:`/${e.$route.params.locale||""}`},{default:s(()=>[Q,h("h1",W,V(e.title),1)]),_:1},8,["to"])])}const Y=f(G,[["render",X],["__scopeId","data-v-43e184f5"]]),Z=_({name:"SearchSelect",components:{Loading:E},props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fetch:{type:Function,default(){return()=>{}}}},emits:["update:modelValue","change","select"],setup(e){const{proxy:t}=w(),c=S(!1),a=S("");return y(()=>e.modelValue,r=>{a.value=r},{immediate:!0}),y(()=>a,O.exports.debounce(function(r){t.$emit("update:modelValue",r),t.$emit("change",r)},300)),{loading:c,searchValue:a}},methods:{keydown(e){e.keyCode===229&&(e.returnValue=!1,e.stopPropagation()),e.keyCode===32&&(e.returnValue=!1)},getExecText(e){return e.replace(new RegExp(/(<([^>]+)>)/,"gi"),"")},handleSelect({value:e}){this.$emit("select",e)},async handleSearch(e,t){const c=e.toLowerCase().replace(new RegExp(/[-[\]{}()*+?.,\\^$|#\s]/g),"\\$&");let a=[];if(!c){t(a);return}this.loading=!0,a=await this.fetch(c)||[],a.forEach(l=>{l.label=l.label.replace(new RegExp(c,"gi"),i=>`<span class="search-select-highlight">${i}</span>`)}),t(a),setTimeout(()=>{B(()=>{this.loading=!1})},200)}}});const ee=["title","innerHTML"];function te(e,t,c,a,r,l){const i=o("loading"),u=o("el-icon"),m=o("IconFont"),p=o("el-autocomplete");return g(),$(p,j({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=d=>e.searchValue=d),modelModifiers:{trim:!0}},e.$attrs,{class:"search-input-container","popper-class":"search-select-container","trigger-on-focus":!1,"fetch-suggestions":e.handleSearch,placeholder:e.placeholder,onSelect:e.handleSelect,onKeydownCapture:t[1]||(t[1]=d=>e.keydown(d))}),F({default:s(({item:d})=>[h("span",{title:e.getExecText(d.label),innerHTML:d.label},null,8,ee)]),_:2},[e.loading?{name:"suffix",fn:s(()=>[n(u,{class:"search-loading-icon"},{default:s(()=>[n(i)]),_:1})]),key:"0"}:{name:"suffix",fn:s(()=>[h("i",{class:"search-icon"},[n(m,{icon:"iconsearch"})])]),key:"1"}]),1040,["modelValue","fetch-suggestions","placeholder","onSelect"])}const oe=f(Z,[["render",te]]),ae=_({name:"SearchCorporation",components:{SearchSelect:oe},emits:["select"],setup(){return{searchValue:S("")}},methods:{async handleFetchSearch(e){return A.map(t=>({value:t,label:t}))},handleSelectSearch(e){this.$emit("select",e)}}});function ne(e,t,c,a,r,l){const i=o("SearchSelect");return g(),$(i,j({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=u=>e.searchValue=u),fetch:e.handleFetchSearch,placeholder:"\u641C\u7D22\u9879\u76EE","select-when-unmatched":"","highlight-first-item":""},e.$attrs,{onSelect:e.handleSelectSearch}),null,16,["modelValue","fetch","onSelect"])}const se=f(ae,[["render",ne]]),re=_({name:"ProjectList",components:{NavigationNavBar:D,NavigationSideLogo:Y,ProjectTableHeader:R,ProjectTableBody:U,SearchCorporation:se},setup(){const{proxy:e}=w(),t=q(),c=v();function a(){const l=x({name:"",corpName:"",notes:""});e.$ModalDialog({title:c.t("project.create"),top:"10vh",width:"50vw",showClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,renderComponent:{data:l,component:M},async onConfirm(i,u){if(!await i.validateRules())return Promise.reject(new Error("error"));u.fullLoading=!0;const{error:p,data:d}=await t.createProject(l);if(u.fullLoading=!1,p)return Promise.reject(new Error("error"));t.getProjectList()}})}function r(l){t.getProjectList({kw:l})}return r(),{handleCreateProject:a,handleSelectSearch:r}}});function ce(e,t,c,a,r,l){const i=o("NavigationSideLogo"),u=o("NavigationNavBar"),m=o("IconFont"),p=o("el-button"),d=o("LayoutSection"),C=o("SearchCorporation"),L=o("ProjectTableHeader"),P=o("ProjectTableBody"),b=o("LayoutArea");return g(),$(b,null,{top:s(()=>[n(u,{fixed:!1},{default:s(()=>[n(i)]),_:1})]),side:s(()=>[n(d,{title:e._t("project.manageTitle")},{default:s(()=>[n(p,{type:"primary",class:"create-action",onClick:t[0]||(t[0]=le=>e.handleCreateProject())},{default:s(()=>[n(m,{icon:"iconestablish"}),H(" "+V(e._t("project.create")),1)]),_:1})]),_:1},8,["title"])]),content:s(()=>[n(d,{"has-divider":"","flex-content":""},{head:s(()=>[n(C,{onSelect:e.handleSelectSearch},null,8,["onSelect"])]),default:s(()=>[n(L),n(P)]),_:1})]),_:1})}const ge=f(re,[["render",ce],["__scopeId","data-v-856d5574"]]);export{ge as default};
