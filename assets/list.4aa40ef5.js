import{d as f,z as V,i as $,_ as p,r as n,o as m,b as T,h as l,w as r,e as g,t as b,x as E,y as N,l as k,u as x,f as v,B as w,C as B,c as y,D as F,G as j,H,I}from"./index.30dbd247.js";import{N as M}from"./NavBar.3662675c.js";import R from"./ProjectForm.1a94c917.js";import D from"./TableHeader.88a723e2.js";import{c as O,P as U,u as z}from"./TableBody.a1d69c86.js";import{l as A}from"./lodash.d45e6345.js";import"./Translations.d56dfcaa.js";import"./ProjectItem.b1d880e7.js";const G=f({name:"NavigationSideLogo",setup(){const e=V();return{title:$(()=>e.t("base.systemTitle"))}}}),K={class:"side-logo-container"},q=(e=>(E("data-v-0574b5c5"),e=e(),N(),e))(()=>g("img",{class:"side-logo-img",src:"assets/i18n.8595eb6e.svg",alt:"\u5546\u6807"},null,-1)),J={class:"side-logo-title"};var Q=p(G,[["render",function(e,t,c,o,a,d){const s=n("router-link");return m(),T("div",K,[l(s,{to:`/${e.$route.params.locale||""}`},{default:r(()=>[q,g("h1",J,b(e.title),1)]),_:1},8,["to"])])}],["__scopeId","data-v-0574b5c5"]]);const W=f({name:"SearchSelect",components:{Loading:k},props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fetch:{type:Function,default:()=>()=>{}}},emits:["update:modelValue","change","select"],setup(e){const{proxy:t}=x(),c=v(!1),o=v("");return w(()=>e.modelValue,a=>{o.value=a},{immediate:!0}),w(()=>o,A.exports.debounce(function(a){t.$emit("update:modelValue",a),t.$emit("change",a)},300)),{loading:c,searchValue:o}},methods:{keydown(e){e.keyCode===229&&(e.returnValue=!1,e.stopPropagation()),e.keyCode===32&&(e.returnValue=!1)},getExecText:e=>e.replace(new RegExp(/(<([^>]+)>)/,"gi"),""),handleSelect({value:e}){this.$emit("select",e)},async handleSearch(e,t){const c=e.toLowerCase().replace(new RegExp(/[-[\]{}()*+?.,\\^$|#\s]/g),"\\$&");let o=[];if(!c)return void t(o);this.loading=!0,o=await this.fetch(c)||[],o.forEach(a=>{a.label=a.label.replace(new RegExp(c,"gi"),d=>`<span class="search-select-highlight">${d}</span>`)}),t(o),setTimeout(()=>{B(()=>{this.loading=!1})},200)}}}),X=["title","innerHTML"],Y=f({name:"SearchCorporation",components:{SearchSelect:p(W,[["render",function(e,t,c,o,a,d){const s=n("loading"),u=n("el-icon"),h=n("IconFont"),S=n("el-autocomplete");return m(),y(S,j({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=i=>e.searchValue=i),modelModifiers:{trim:!0}},e.$attrs,{class:"search-input-container","popper-class":"search-select-container","trigger-on-focus":!1,"fetch-suggestions":e.handleSearch,placeholder:e.placeholder,onSelect:e.handleSelect,onKeydownCapture:t[1]||(t[1]=i=>e.keydown(i))}),F({default:r(({item:i})=>[g("span",{title:e.getExecText(i.label),innerHTML:i.label},null,8,X)]),_:2},[e.loading?{name:"suffix",fn:r(()=>[l(u,{class:"search-loading-icon"},{default:r(()=>[l(s)]),_:1})])}:{name:"suffix",fn:r(()=>[g("i",{class:"search-icon"},[l(h,{icon:"iconsearch"})])])}]),1040,["modelValue","fetch-suggestions","placeholder","onSelect"])}]])},emits:["select"],setup:()=>({searchValue:v("")}),methods:{handleFetchSearch:async e=>O.map(t=>({value:t,label:t})),handleSelectSearch(e){this.$emit("select",e)}}});var se=p(f({name:"ProjectList",components:{NavigationNavBar:M,NavigationSideLogo:Q,ProjectTableHeader:D,ProjectTableBody:U,SearchCorporation:p(Y,[["render",function(e,t,c,o,a,d){const s=n("SearchSelect");return m(),y(s,j({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=u=>e.searchValue=u),fetch:e.handleFetchSearch,placeholder:"\u641C\u7D22\u9879\u76EE","select-when-unmatched":"","highlight-first-item":""},e.$attrs,{onSelect:e.handleSelectSearch}),null,16,["modelValue","fetch","onSelect"])}]])},setup(){const{proxy:e}=x(),t=z(),c=V();function o(a){t.getProjectList({kw:a})}return o(),{handleCreateProject:function(){const a=I({name:"",corpName:"",notes:""});e.$ModalDialog({title:c.t("project.create"),top:"10vh",width:"50vw",showClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,renderComponent:{data:a,component:R},async onConfirm(d,s){if(!await d.validateRules())return Promise.reject(new Error("error"));s.fullLoading=!0;const{error:u,data:h}=await t.createProject(a);if(s.fullLoading=!1,u)return Promise.reject(new Error("error"));t.getProjectList()}})},handleSelectSearch:o}}}),[["render",function(e,t,c,o,a,d){const s=n("NavigationSideLogo"),u=n("NavigationNavBar"),h=n("IconFont"),S=n("el-button"),i=n("LayoutSection"),C=n("SearchCorporation"),P=n("ProjectTableHeader"),_=n("ProjectTableBody"),L=n("LayoutArea");return m(),y(L,null,{top:r(()=>[l(u,{fixed:!1},{default:r(()=>[l(s)]),_:1})]),side:r(()=>[l(i,{title:e._t("project.manageTitle")},{default:r(()=>[l(S,{type:"primary",class:"create-action",onClick:t[0]||(t[0]=Z=>e.handleCreateProject())},{default:r(()=>[l(h,{icon:"iconestablish"}),H(" "+b(e._t("project.create")),1)]),_:1})]),_:1},8,["title"])]),content:r(()=>[l(i,{"has-divider":"","flex-content":""},{head:r(()=>[l(C,{onSelect:e.handleSelectSearch},null,8,["onSelect"])]),default:r(()=>[l(P),l(_)]),_:1})]),_:1})}],["__scopeId","data-v-ca6f0964"]]);export{se as default};
